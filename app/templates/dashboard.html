<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Trading Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
  h1 { text-align: center; }
  section { background: #fff; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 0 5px #ccc; }
  pre { background: #222; color: #0f0; padding: 10px; overflow-x: auto; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border-bottom: 1px solid #ddd; padding: 6px; text-align: left; }
  th { background: #eee; }
</style>
</head>
<body>
<h1>Binance Bot Dashboard</h1>

<section>
  <h2>Signals</h2>
  <pre id="signals">Loading...</pre>
</section>

<section>
  <h2>Stats</h2>
  <pre id="stats">Loading...</pre>
</section>

<section>
  <h2>Open Positions</h2>
  <table id="positions"><tr><th>Symbol</th><th>Side</th><th>Qty</th><th>Entry</th><th>TP</th><th>SL</th><th>PnL</th></tr></table>
</section>

<section>
  <h2>History (Last 20)</h2>
  <table id="history"><tr><th>Symbol</th><th>Side</th><th>Entry</th><th>Exit</th><th>PnL</th><th>Closed At</th></tr></table>
</section>

<section>
  <h2>Health</h2>
  <pre id="health">Loading...</pre>
</section>

<script>
async function fetchJson(url){ const r = await fetch(url); return await r.json(); }

async function refresh(){
  try {
    document.getElementById('signals').textContent = JSON.stringify(await fetchJson('/signals'), null, 2);
    document.getElementById('stats').textContent   = JSON.stringify(await fetchJson('/stats'), null, 2);

    // Positions
    const pos = await fetchJson('/paper/positions');
    const ptab = document.getElementById('positions');
    ptab.innerHTML = "<tr><th>Symbol</th><th>Side</th><th>Qty</th><th>Entry</th><th>TP</th><th>SL</th><th>PnL</th></tr>";
    for (const [s,v] of Object.entries(pos.open||{})){
      ptab.innerHTML += `<tr>
        <td>${s}</td><td>${v.side}</td><td>${v.qty}</td>
        <td>${v.entry.toFixed(2)}</td><td>${v.tp.toFixed(2)}</td>
        <td>${v.stop.toFixed(2)}</td><td>${v.pnl.toFixed(4)}</td>
      </tr>`;
    }

    // History
    const hist = await fetchJson('/history?limit=20');
    const htab = document.getElementById('history');
    htab.innerHTML = "<tr><th>Symbol</th><th>Side</th><th>Entry</th><th>Exit</th><th>PnL</th><th>Closed At</th></tr>";
    for (const row of hist.rows||[]){
      htab.innerHTML += `<tr>
        <td>${row.symbol}</td><td>${row.side}</td>
        <td>${row.entry.toFixed(2)}</td><td>${row.exit.toFixed(2)}</td>
        <td>${row.pnl.toFixed(4)}</td><td>${row.closed_at}</td>
      </tr>`;
    }

    document.getElementById('health').textContent = JSON.stringify(await fetchJson('/healthz'), null, 2);
  } catch(e){ console.error(e); }
}
setInterval(refresh, 5000);
refresh();
</script>
</body>
</html>
