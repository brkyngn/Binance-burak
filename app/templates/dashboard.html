<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scalper Dashboard</title>
<style>
:root{
  --bg:#0b1020;
  --card:#0e1420;
  --line:#1f2937;
  --fg:#e7ecf5;
  --muted:#93a0b8;
  --pos:#22c55e;
  --neg:#ef4444;
  --warn:#f59e0b;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.5 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"}

.container{max-width:1280px;margin:0 auto;padding:16px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.badge{color:var(--muted);font-size:12px}

.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-bottom:14px}
.card h2{margin:0 0 8px;font-size:16px}
.hint{color:var(--muted);font-size:12px}

.table-responsive{overflow:auto}
.table-compact{width:100%;border-collapse:separate;border-spacing:0}
.table-compact th,.table-compact td{padding:6px 8px;border-bottom:1px solid var(--line);text-align:left}
.table-compact thead th{position:sticky;top:0;background:#0f1626;z-index:1}
.table-compact tr:hover td{background:#0f172a}
.num{text-align:right}
.pnl-pos{color:var(--pos);font-weight:700}
.pnl-neg{color:var(--neg);font-weight:700}
.muted{color:var(--muted)}
.mono{font-variant-numeric:tabular-nums}

/* inputs & buttons */
.input{background:#0f172a;border:1px solid var(--line);color:var(--fg);border-radius:8px;padding:6px 8px;width:90px}
.btn{background:#111827;border:1px solid var(--line);color:var(--fg);border-radius:10px;padding:8px 10px;font-weight:600;cursor:pointer}
.btn:hover{filter:brightness(1.1)}

/* toast */
.toast{position:fixed;right:16px;bottom:16px;background:#0c111b;border:1px solid #223049;color:#e8eaf0;padding:10px 12px;border-radius:10px;opacity:0;transform:translateY(8px);transition:all .2s}
.toast.show{opacity:1;transform:translateY(0)}

/* signals helpers */
.ok{color:var(--pos);font-weight:600}
.bad{color:var(--neg);font-weight:600}
.warn{color:var(--warn);font-weight:600}
.chip{padding:.1rem .35rem;border-radius:.35rem;background:#111827;border:1px solid #1f2937}
.chip.num{font-variant-numeric:tabular-nums}

/* KPI şeridi */
.kpis{display:grid;gap:10px;grid-template-columns:repeat(5,1fr);margin-bottom:16px}
.kpi{background:#0e1420;border:1px solid var(--line);border-radius:12px;padding:12px}
.kpi .label{color:var(--muted);font-size:12px;margin-bottom:6px}
.kpi .value{font-size:22px;font-weight:700}
@media(max-width:900px){.kpis{grid-template-columns:repeat(2,1fr)}}

/* SIGNALS styles */
.sig-long{ color: var(--pos); font-weight:700 }
.sig-short{ color: var(--neg); font-weight:700 }
.sig-raw{ color: var(--muted); font-weight:600 }
.rule-pass{ background:#0b2a15; border-color:#16452a; color:#b7f0c3 }
.rule-warn{ background:#2a210b; border-color:#4a3c13; color:#f0e0b7 }
.rule-fail{ background:#2a0b0b; border-color:#4a1717; color:#f0b7b7 }

</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Scalper Dashboard</h1>
    <div class="badge"><span id="symbolsBadge">SYMBOLS</span> · <span id="streamBadge">STREAM</span> · <span id="clock"></span></div>
  </div>

  <!-- KPI BAR -->
  <div class="kpis">
    <div class="kpi">
      <div class="label">Toplam Long (kapandı)</div>
      <div class="value" id="kpiLong">0</div>
    </div>
    <div class="kpi">
      <div class="label">Toplam Short (kapandı)</div>
      <div class="value" id="kpiShort">0</div>
    </div>
    <div class="kpi">
      <div class="label">Kârla Kapanan (Win)</div>
      <div class="value ok" id="kpiWins">0</div>
    </div>
    <div class="kpi">
      <div class="label">Zararla Kapanan (Loss)</div>
      <div class="value bad" id="kpiLosses">0</div>
    </div>
    <div class="kpi">
      <div class="label">Win Rate</div>
      <div class="value" id="kpiWinRate">0%</div>
    </div>
  </div>

  <!-- Manual Trade Paneli -->
  ... (aynı içerik yukarıdaki gibi kalıyor) ...

<script>
// --- History + KPIs ---
async function loadHistory(limit=100){
  const body=document.getElementById('histBody');
  try{
    const r=await fetch(`/history?limit=${limit}`,{cache:'no-store'}); const j=await r.json();
    const rows=(j&&j.ok&&Array.isArray(j.rows))?j.rows:[];
    if(limit===100){
      body.innerHTML='';
      if(rows.length===0){ body.innerHTML = `<tr><td class=\"muted\" colspan=\"12\">Kayıt yok.</td></tr>`; }
      for(const x of rows){
        const tr=document.createElement('tr');
        tr.innerHTML=`...`; // tablo satırları
        body.appendChild(tr);
      }
    }
    computeKPIs(rows);
  }catch(e){ if(limit===100) body.innerHTML = `<tr><td class=\"muted\" colspan=\"12\">Yüklenemedi.</td></tr>`; computeKPIs([]); }
}

async function loadSummary(){
  try{ const r=await fetch('/history?limit=10000',{cache:'no-store'}); const j=await r.json(); computeKPIs(j?.rows||[]);}catch{ computeKPIs([]); }
}
</script>
</body>
</html>
